<!-- Save as index.html -->
<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BookMyShow - IPL Demo (Public)</title>
<style>
  :root{--brand:#d92b2b;--muted:#666}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:#f5f6f8;color:#111}
  .topbar{background:var(--brand);color:#fff;padding:12px 18px;display:flex;align-items:center;gap:12px}
  .logo{font-weight:800;font-size:20px}
  .hero{height:220px;background:#111;color:#fff;display:flex;align-items:flex-end;padding:20px;background-size:cover;background-position:center}
  .hero .hero-card{background:rgba(0,0,0,0.45);padding:12px;border-radius:6px}
  .container{max-width:1100px;margin:18px auto;padding:0 16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(12,20,40,0.06);display:flex;flex-direction:column;gap:8px}
  .thumb{height:140px;border-radius:8px;background:#ddd center/cover no-repeat}
  .meta{display:flex;justify-content:space-between;align-items:center}
  .tag{background:#f2f2f2;padding:6px 8px;border-radius:6px;font-size:13px}
  .btn{background:var(--brand);color:#fff;padding:8px 12px;border:none;border-radius:8px;cursor:pointer}
  .muted{color:var(--muted)}
  /* modal/seatmap */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;padding:18px;z-index:999}
  .modal .panel{width:100%;max-width:980px;background:#fff;border-radius:10px;padding:16px;max-height:90vh;overflow:auto}
  .seat{display:inline-block;width:36px;height:36px;margin:6px;border-radius:6px;text-align:center;line-height:36px;cursor:pointer}
  .avail{background:#eaf7ea;border:1px solid #bfe6bf}
  .booked{background:#ffdede;border:1px solid #f1a7ad;cursor:not-allowed}
  .selected{outline:3px solid var(--brand)}
  @media(max-width:640px){
    .hero{height:140px}
    .seat{width:30px;height:30px;line-height:30px;margin:4px}
  }
</style>
</head>
<body>
  <div class="topbar">
    <div class="logo">TICKET‑BMS</div>
    <div style="flex:1"></div>
    <!-- no admin button here (hidden public) -->
  </div>

  <div id="hero" class="hero" style="background-image: url('');">
    <div class="hero-card">
      <div style="font-size:18px;font-weight:700">IPL 2025 • Ticket Booking (Demo)</div>
      <div class="muted">Public page — केवल admin द्वारा add किए गए इवेंट्स यहाँ दिखेंगे</div>
    </div>
  </div>

  <div class="container">
    <h2 style="margin:12px 0">Upcoming Matches</h2>
    <div id="eventsGrid" class="grid"></div>

    <div id="emptyMsg" class="card" style="display:none;text-align:center">
      <div style="font-weight:700">कोई मिलते-जुलते मैच नहीं मिला</div>
      <div class="muted" style="margin-top:6px">Admin पैनल में लॉगिन करके इवेंट जोड़ें (admin.html)</div>
    </div>
  </div>

  <!-- Seat modal -->
  <div id="seatModal" class="modal" style="display:none" onclick="closeModal(event)">
    <div class="panel" onclick="event.stopPropagation()">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 id="modalTitle" style="margin:0"></h3>
          <div id="modalSub" class="muted"></div>
        </div>
        <div><button class="btn" onclick="closeModal()">Close</button></div>
      </div>
      <hr/>
      <div id="seatMapArea"></div>

      <div id="confirmArea" style="display:none;margin-top:12px">
        <div><b>Selected:</b> <span id="selSeat"></span> — ₹<span id="selPrice"></span></div>
        <input id="buyerName" placeholder="आपका नाम (demo)" style="padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:8px"/>
        <button class="btn" onclick="confirmBooking()" style="margin-left:8px">Confirm (Demo)</button>
      </div>
    </div>
  </div>

<script>
/* ====== storage keys ====== */
const STORAGE_KEY = 'bms_demo_events_v1'; // contains array of events {id,title,date,venue,banner,dataSeats}
function loadEvents(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return [];
    return JSON.parse(raw);
  }catch(e){
    console.error(e); return [];
  }
}
function saveEvents(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

/* ===== render logic ===== */
function renderList(){
  const events = loadEvents();
  const grid = document.getElementById('eventsGrid');
  grid.innerHTML='';
  if(!events || events.length===0){
    document.getElementById('emptyMsg').style.display='block';
    return;
  } else document.getElementById('emptyMsg').style.display='none';

  events.forEach(ev=>{
    const card = document.createElement('div'); card.className='card';
    const thumbStyle = ev.banner ? `background-image:url(${ev.banner});background-size:cover;background-position:center` : '';
    card.innerHTML = `<div class="thumb" style="${thumbStyle}height:140px;border-radius:8px"></div>
      <div class="meta"><div><div style="font-weight:700">${escapeHtml(ev.title)}</div><div class="muted">${escapeHtml(ev.date)} • ${escapeHtml(ev.venue)}</div></div>
      <div><div class="tag">BOOK</div></div></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="muted">From ₹${ev.basePrice||200}</div>
        <div><button class="btn" onclick="openSeatModal('${ev.id}')">Select Seats</button></div>
      </div>`;
    grid.appendChild(card);
  });
}

/* sanitize basic */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* seat modal logic */
let currentEvent=null, selectedSeat=null;
function openSeatModal(id){
  const events = loadEvents();
  currentEvent = events.find(x=>x.id===id);
  if(!currentEvent) return alert('Event not found');
  document.getElementById('modalTitle').innerText = currentEvent.title;
  document.getElementById('modalSub').innerText = (currentEvent.date||'') + ' • ' + (currentEvent.venue||'');
  selectedSeat = null;
  document.getElementById('confirmArea').style.display='none';
  buildSeatMap(currentEvent);
  document.getElementById('seatModal').style.display='flex';
}
function closeModal(e){
  if(e && e.stopPropagation) e.stopPropagation();
  document.getElementById('seatModal').style.display='none';
}
function buildSeatMap(ev){
  const area = document.getElementById('seatMapArea');
  area.innerHTML='';
  const seats = ev.seats || [];
  const grouped = {};
  seats.forEach(s=> { if(!grouped[s.row]) grouped[s.row]=[]; grouped[s.row].push(s); });
  Object.keys(grouped).sort().forEach(r=>{
    const rowLabel = document.createElement('div'); rowLabel.style.marginTop='10px';
    rowLabel.innerHTML = `<strong>Row ${r}</strong>`;
    area.appendChild(rowLabel);
    const rowDiv = document.createElement('div');
    grouped[r].forEach(s=>{
      const sp = document.createElement('div');
      sp.className = 'seat ' + (s.status==='available' ? 'avail' : 'booked');
      sp.innerText = s.number;
      sp.title = '₹'+s.price;
      if(s.status==='available') sp.onclick = ()=>selectSeat(ev.id, s.id);
      rowDiv.appendChild(sp);
      // attach data-id for highlight
      sp.dataset.seatId = s.id;
      sp.dataset.seatNum = s.number;
    });
    area.appendChild(rowDiv);
  });
}
function selectSeat(evId, seatId){
  const events = loadEvents();
  const ev = events.find(x=>x.id===evId);
  const s = (ev.seats||[]).find(x=>x.id===seatId);
  if(!s || s.status!=='available') return;
  selectedSeat = s;
  document.getElementById('selSeat').innerText = s.row + s.number;
  document.getElementById('selPrice').innerText = s.price;
  document.getElementById('confirmArea').style.display='block';
  // highlight selected
  Array.from(document.querySelectorAll('.seat')).forEach(el=> el.classList.remove('selected'));
  Array.from(document.querySelectorAll('.seat')).forEach(el=> { if(el.dataset.seatNum==s.number) el.classList.add('selected'); });
}
function confirmBooking(){
  if(!selectedSeat) return alert('Select seat first');
  const name = document.getElementById('buyerName').value.trim() || 'Demo User';
  // mark booked in storage
  const events = loadEvents();
  const ev = events.find(x=>x.id===currentEvent.id);
  const seat = ev.seats.find(x=>x.id===selectedSeat.id);
  if(!seat) return alert('Seat not found');
  if(seat.status==='booked') return alert('Already booked');
  seat.status='booked';
  saveEvents(events);
  alert('Demo booking confirmed: ' + ev.title + ' • Seat '+selectedSeat.row+selectedSeat.number+' • '+name);
  buildSeatMap(ev);
  document.getElementById('confirmArea').style.display='none';
  renderList(); // update any summary visible
}

/* init */
renderList();
</script>
</body>
  </html>
